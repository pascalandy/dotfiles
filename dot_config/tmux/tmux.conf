# === TERMINAL COLOR SUPPORT ===
# Enable true color (24-bit) support for better color rendering in tmux
# The "Tc" flag tells tmux to pass through terminal color codes
# smcup@:rmcup@ fixes Option key handling on macOS
set-option -sa terminal-overrides ",xterm*:Tc:smcup@:rmcup@"

set -g default-terminal "tmux-256color"

# === MOUSE SUPPORT ===
# Enable mouse support for clicking panes, resizing, selecting text, etc.
set -g mouse on

# === PREFIX KEY CONFIGURATION ===
# Set the new prefix to Ctrl+Space. By default, tmux uses Ctrl+B as the prefix key (the key you hold before a command)
set -g prefix C-Space
# Unbind the default prefix key (Ctrl+B)
unbind C-b

# Allow sending Ctrl+Space to applications inside tmux by pressing prefix twice
bind C-Space send-prefix

# === PANE NAVIGATION (VIM-STYLE) ===
# These shortcuts require the prefix key first (Ctrl+Space + h/j/k/l)
# Navigate between panes using vim keybindings (hjkl):
# - h: select left pane
# - j: select down pane
# - k: select up pane
# - l: select right pane
bind h select-pane -L
bind j select-pane -D 
bind k select-pane -U
bind l select-pane -R

# === INDEXING CONFIGURATION ===
# By default, tmux numbers windows and panes starting from 0
# These settings change it to start from 1 (more intuitive for keyboard navigation)
set -g base-index 1                    # Windows start at 1 instead of 0
set -g pane-base-index 1               # Panes start at 1 instead of 0
set-window-option -g pane-base-index 1 # Redundant but ensures consistency
set-option -g renumber-windows on      # Automatically renumber windows after closing one

# === PANE NAVIGATION (WITHOUT PREFIX) ===
# These shortcuts work WITHOUT pressing the prefix key first (Alt+arrow keys)
# Useful for quickly switching between panes
bind -n C-M-Left select-pane -L    # Ctrl+Option+Left
bind -n C-M-Right select-pane -R   # Ctrl+Option+Right
bind -n C-M-Up select-pane -U      # Ctrl+Option+Up
bind -n C-M-Down select-pane -D    # Ctrl+Option+Down

# === WINDOW NAVIGATION (WITHOUT PREFIX) ===
# Switch between windows using Shift+arrow keys (no prefix needed)
bind -n S-Left  previous-window  # Shift+Left Arrow: go to previous window
bind -n S-Right next-window      # Shift+Right Arrow: go to next window

# === WINDOW NAVIGATION (VIM-STYLE WITHOUT PREFIX) ===
# Alternative vim-style window switching without prefix
bind -n M-H previous-window  # Alt+H: go to previous window
bind -n M-L next-window      # Alt+L: go to next window

# === THEME CONFIGURATION ===
# Use the Catppuccin color scheme (frappe is the dark blue variant)
# Other options: mocha (darker), macchiato (medium), latte (light)
set -g @catppuccin_flavour 'frappe'

# === PLUGIN MANAGER SETUP ===
# These lines configure tpm (Tmux Plugin Manager) and load plugins
set -g @plugin 'tmux-plugins/tpm'                          # Plugin manager itself
set -g @plugin 'tmux-plugins/tmux-sensible'                # Sensible defaults for tmux
set -g @plugin 'dreamsofcode-io/catppuccin-tmux'           # Catppuccin theme
set -g @plugin 'christoomey/vim-tmux-navigator'            # Seamless navigation with vim
set -g @plugin 'tmux-plugins/tmux-yank'                    # Improved copy/paste to system clipboard

# Enable system clipboard integration (automatically copy selections to clipboard)
set -g set-clipboard on

# Load the plugin manager and all plugins
run '~/.tmux/plugins/tpm/tpm'

# === VI MODE (COPY MODE) ===
# Use vi keybindings in copy mode (when selecting and copying text)
set-window-option -g mode-keys vi

# === COPY MODE KEYBINDINGS ===
# These are active when you enter copy mode (Ctrl+Space + [ by default)
# They follow vim conventions for selecting and copying text

# v: Start selection (like "v" in vim to enter visual mode)
bind-key -T copy-mode-vi v send-keys -X begin-selection

# Ctrl+V: Toggle between character-wise and block-wise selection (rectangle mode)
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# y: Copy the selection and exit copy mode (like "y" in vim to yank)
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# === WINDOW SPLITTING ===
# Split windows while maintaining the current directory in the new pane

# ": Split window vertically (creates a pane below)
bind '"' split-window -v -c "#{pane_current_path}"

# %: Split window horizontally (creates a pane to the right)
bind % split-window -h -c "#{pane_current_path}"

# Enable OSC 8 hyperlinks passthrough
set -g allow-passthrough on
set -ga terminal-features ",tmux-256color:hyperlinks"
set -ga terminal-features ",xterm-ghostty:hyperlinks"